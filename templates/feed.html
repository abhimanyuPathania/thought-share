
{% extends 'base.html' %}

{% block title %}
	<title>Thought Share</title>
{% endblock %}

{% block content %}
	<span style="display:none" id="userGroupsJSON" data-groupJSON = "{{group_json}}"></span>
	<span style="display:none" id="userJSON" data-userJSON = "{{user_json}}"></span>
	
	<script type="text/javascript" data-main="../scripts/feedMain" src="../scripts/require.js"></script>
	<h2>Your feedpage // {{display_name}} //</h2>
	<a href="{{status_url}}">Logout</a>
	
	<div>
		<post-notification params="parent: feedPageViewModelRef"></post-notification>
		<request-notification></request-notification>
		<group-search></group-search>	
	</div>

	<div>
		<h4>Groups joined</h4>
        <ul data-bind="foreach: groups">
        	<li data-bind = "text: name, click: $parent.updateCurrentGroup"></li>
        </ul>	
	</div>
	
	<h4>Feed</h4>
	<!-- ko if: currentGroup() -->
		<button data-bind = "enable: newFeedFlag(), click:updateCurrentGroupFeed">you got new posts</button>
		<p><strong data-bind = "text: currentGroup().name"></strong></p>
		<div>
			<h5>Post in this group</h5>
			<textarea cols="30" rows="10" data-bind="textInput: userPost"></textarea>
			<p><button data-bind="click:postInCurrentGroup">Post</button></p>			
		</div>
    <!-- /ko -->

    <!-- ko ifnot: feed() && currentGroup() -->
		<p>no posts in this group yet</p>
    <!-- /ko -->
	<ul data-bind = "foreach: feed">
		<li>
			<div>
				<img data-bind = "attr: {src: poster_image}">
				<b data-bind = "text: poster_name"></b>
				<i data-bind = "text: timestampText"></i>
			</div>
			<div data-bind="visible: !editing()">
				<p data-bind = "text: post"></p>
				<!-- ko if: $root.user.id === user_id -->
					<div>
						<button type="button" data-bind="click: $root.editPost">Edit</button>
						<button type="button" data-bind="click: $root.deletePost">Delete</button>
					</div>
			    <!-- /ko -->
			</div>
			<!-- ko if: $root.user.id === user_id -->
				<div data-bind="visible: editing()">
					<textarea cols="25" rows="2" data-bind="textInput: post"></textarea>
					<div>
						<button type="button" data-bind="click: $root.saveEdit">Save</button>
						<button type="button" data-bind="click: $root.cancelEdit">Cancel</button>
					</div>
				</div>
			<!-- /ko -->
		</li>
	</ul>
	<button data-bind="visible: moreFeed(), click: fetchMorePosts">Show more posts</button>
	
{% endblock %}
