
{% extends 'base.html' %}

{% block title %}
	<title>Thought Share</title>
{% endblock %}

{% block content %}
	<span style="display:none" id="userGroupsJSON" data-groupJSON = "{{group_json}}"></span>
	<span style="display:none" id="userJSON" data-userJSON = "{{user_json}}"></span>

	<!-- adding the scripts on top since we use them to generate our markup -->
	<script src="../scripts/jquery.js"></script>
	<script src="../scripts/knockout.js"></script>
	<script src="../scripts/sammy.js"></script>
	<script src="../scripts/feed-page.js"></script>

	<h2>Your feedpage // {{display_name}} //</h2>
	<a href="{{status_url}}">Logout</a>
	
	<div>
		<h4>search for groups</h4>
		<p>Enter group name: <input type="text" data-bind="event:{ keyup : queryGroups }"></p>
		<ul data-bind="foreach: groupQueryResults">
			<li>
				<img data-bind="attr: {src: image}">
				<a data-bind="text: name, attr:{href: url}"></a>
			</li>
		</ul>
	</div>
	
	<div>
		<h4>Groups joined</h4>
        <ul data-bind="foreach: groups">
        	<li data-bind = "text: name, click: $parent.updateCurrentGroup"></li>
        </ul>	
	</div>
	
	<h4>Feed</h4>
	<!-- ko if: currentGroup() -->
		<button data-bind = "enable: newFeedFlag(), click:updateCurrentGroupFeed">you got new posts</button>
		<p><strong data-bind = "text: currentGroup().name"></strong></p>
		<div>
			<h5>Post in this group</h5>
			<textarea cols="30" rows="10" data-bind="textInput: userPost"></textarea>
			<p><button data-bind="click:postInCurrentGroup">Post</button></p>			
		</div>
    <!-- /ko -->

    <!-- ko ifnot: feed() && currentGroup() -->
		<p>no posts in this group yet</p>
    <!-- /ko -->
	<ul data-bind = "foreach: feed">
		<li>
			<p>
				<img data-bind = "attr: {src: poster_image}">
				<b data-bind = "text: poster_name"></b>
				<i data-bind = "text: timestamp"></i>
			</p>
			<p data-bind = "text: post"></p>
		</li>
	</ul>

	<h4>Post Notifications</h4>
	<button data-bind = "click: fetchPostNotification, enable: unreadPostNotifications() > 0"> Read</button>
	<p>you have <b data-bind = "text: unreadPostNotifications"></b> unread notificaitons</p>
	<ul data-bind= "foreach: postNotifications">
		<li>
			<p data-bind = "text: notificationText"></p>
			<p><i data-bind = "text: timestampText"></i></p>
		</li>
	</ul>

	<h4>Request Notifications</h4>
	<p>you have <b data-bind="text: unreadRequestNotifications"></b> request notifications</p>
	<button data-bind = "click: updateRequestNotificationsReadStatus, enable: unreadRequestNotifications() > 0">OK! checked</button>
	<ul data-bind="foreach: requestNotifications">
		<li data-bind = "text: text"></li>
		<button data-bind = "click: $root.completeRequest, visible:complete === false">accept</button>
	</ul>

{% endblock %}
